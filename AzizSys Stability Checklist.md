# ✅ AzizSys Stability Checklist
نسخة هندسية قابلة للتنفيذ لتحسين الاستقرار ومنع الأخطاء مثل:
- `TypeError: Cannot read properties of undefined (reading 'handleRequest')`
- `Injector: تعذر حل التبعية`
- `[Placeholder] called`

---

## 🎯 المرحلة الأولى: وحدات التهيئة الأساسية

**الحالة: ✅ تم التنفيذ**

### الملفات المتأثرة:
- `00_utils.js`
- `00_module_verifier.js`
- `00_dependency_map.js`
- `01_config.js`

### الخطوات:
1. **تم التعديل:** تم تحديث `filePushOrder` في `.clasp.json` لضمان تحميل الوحدات الأساسية (`00_*`, `01_*`) في البداية.

### التعديل داخل الوحدات الأخرى:
```javascript
if (!ModuleVerifier.isReady('AgentsCatalog')) {
  return Dialogue.createError('الوحدة AgentsCatalog غير جاهزة.');
}
```

---

## 🧱 المرحلة الثانية: وحدات الوكلاء والكتالوج (Agents & Catalog)

**الحالة: ✅ تم التنفيذ**

### الملفات المتأثرة:
- `25_ai_agents/agent_developer.gs.js`
- `25_ai_agents/agent_cfo.gs.js`
- `25_ai_agents/general_agent.js`
- `25_ai_agents/agents_catalog.js`
- `25_ai_agents/2_agents_router.js`

### الترتيب المقترح:
1.  **تم التحقق:** ترتيب التحميل في `.clasp.json` صحيح ويضمن تحميل الوكلاء قبل الكتالوج والموجه.

### التعديلات:
- **تم الإصلاح:** تم تصحيح الأسماء التي يعيدها `Agents.Router` (مثل `developer` -> `DeveloperAgent`) لتتطابق مع الأسماء المستخدمة في `Agents.Catalog`، مما يحل خطأ منطقيًا حرجًا في توجيه الطلبات.
- **تم التحسين:** تمت إضافة طبقة حماية إضافية في `AgentDispatcher` للتحقق من وجود `AgentsCatalog` قبل استخدامه، مما يمنع الأخطاء في حال فشل تهيئة الكتالوج.

---

## 🤖 المرحلة الثالثة: وحدات AI الأساسية (Core AI)

**الحالة: ✅ تم التنفيذ**

### الملفات المتأثرة:
- `20_ai/3_ai_dispatcher.js`
- `20_ai/5_ai_core.js`
- `20_ai/5_ai_orchestrator.js`
- `20_ai/5_ai_toolExecutor.js`
- `20_ai/4_ai_context.js`
- `20_ai/6_ai_intentAnalyzer.js`

### التعديلات:
- **تم الإصلاح:** تم فك التبعية الدائرية بين `Orchestrator` و `Dispatcher`. كانت وحدة `Orchestrator` تستدعي دالة غير موجودة في `Dispatcher` لمعالجة ردود الـ API.
- **تم التحسين:** تم نقل منطق معالجة ردود الـ API بالكامل إلى داخل `Orchestrator`، حيث يقوم الآن بتحليل الردود وتوجيه استدعاءات الأدوات إلى `ToolExecutor` مباشرة، مما يجعل البنية أكثر وضوحًا واستقرارًا.
- **تم التحسين:** تم تصحيح منطق بناء السياق في `Orchestrator` ليعتمد على وحدة `AI.Context` المتخصصة بدلاً من `AI.Memory`.

---

## 🧠 المرحلة الرابعة: النظام الدفاعي والمعماري (Defensive & Architectural System)

**الحالة: ✅ تم التنفيذ**

### مهامها:
- **تم التحسين:** تم تعديل `ModuleVerifier` ليدعم التسجيل الصريح للجاهزية عبر دالة `register()`.
- **تمت الأتمتة:** تم تعديل `defineModule` لتقوم بتسجيل كل وحدة تلقائيًا في `ModuleVerifier` فور إنشائها.
- **تم الإنشاء:** تم بناء وحدة `System.DependencyGuardian` الجديدة التي توفر دالة `waitFor()` لانتظار تحميل وحدات معينة.
- **تم الإنشاء:** تمت إضافة ملف `95_stability_reporter.js` يحتوي على دالة `reportModulesStatus()` يمكن تشغيلها يدويًا من المحرر للحصول على تقرير فوري عن صحة النظام.

### ملف مساعد:
```javascript
function reportModulesStatus() {
  // ... (see 95_stability_reporter.js)
}
```

---

## 🖼️ المرحلة الخامسة: واجهة الاستخدام (UI)

**الحالة: ✅ تم التنفيذ**

### الملفات المتأثرة:
- `10_ui/1_ui.gs.js`
- `10_ui/2_ui_developerSidebar.js`
- `10_ui/4_ui_dev_sidebar_handler.js`
- `10_ui/3_ui_action_handler.js`

### الخطوات:
- **تم التحقق:** تم التأكد من أن ملفات واجهة المستخدم يتم تحميلها في مرحلة متأخرة في `filePushOrder`، بعد الوحدات الأساسية.
- **تم التحسين:** تمت إضافة فحص دفاعي في بداية وحدة `System.UI.ActionHandler` باستخدام `ModuleVerifier.isReady()`. هذا الفحص يضمن عدم تفعيل أي إجراءات من واجهة المستخدم قبل أن تكون الوحدات الخلفية الحيوية (مثل `AI.Core`, `Dispatcher`, `AgentsCatalog`) جاهزة تمامًا، مما يمنع الأخطاء الناتجة عن استدعاء النظام قبل اكتمال تهيئته.

---

## 📦 المرحلة السادسة: أتمتة ترتيب التحميل (Automated Load Order)

**الحالة: ✅ تم التنفيذ**

- **تم الإنشاء:** تم إنشاء سكربت `scripts/generatePushOrder.js` (يعمل ببيئة Node.js) يقوم بالآتي:
  - يقرأ ملف `module_manifest.json` لتحليل تبعيات الوحدات.
  - يقوم بعملية فرز طوبولوجي (Topological Sort) لتحديد الترتيب الصحيح لتحميل الوحدات.
  - يكتشف أي تبعيات دائرية ويمنع التحديث في حال وجودها.
  - يقوم بتحديث قائمة `filePushOrder` في ملف `.clasp.json` تلقائيًا، مع الحفاظ على ترتيب الملفات الخاصة (مثل `00_initializer.js` و `99_Code.js`) في أماكنها الصحيحة.
- **الاستخدام:** يمكن تشغيل السكربت من سطر الأوامر (`node scripts/generatePushOrder.js`) بعد أي تغيير في تبعيات الوحدات لضمان بقاء ترتيب التحميل صحيحًا دائمًا.

---

## 📘 المرحلة السابعة: التوثيق والتسليم (Documentation & Delivery)

**الحالة: ✅ تم التنفيذ**

- **تم الإنشاء:** تم إنشاء ملف `AzizSys_Troubleshooting_Guide.md` الذي يوفر حلولاً للمشاكل الشائعة مثل أخطاء `TypeError` والتبعيات الدائرية.
- **تم الإنشاء:** تم إنشاء ملف `AzizSys_Developer_Guide.md` الذي يقدم إرشادات للمطورين حول كيفية إضافة وحدات جديدة، استخدام أدوات الصيانة، وتطبيق ممارسات البرمجة الدفاعية المتبعة في المشروع.
- **تم التحقق:** تم تحديث هذا المستند (`AzizSys_StabilityChecklist.md`) ليعكس إنجاز جميع المراحل المخطط لها.

---

## 🩺 خطة استدامة التوثيق (Documentation Sustainability Plan)

هذه الخطة مبنية على تقرير تدقيق التوثيق لضمان بقاء المشروع واضحًا وقابلاً للصيانة.

---

### ✳️ المرحلة الثامنة: بناء أساس التوثيق (Documentation Scaffolding)

**الهدف:** تسجيل جميع الوحدات غير الموثقة بشكل مبدئي لتفعيل أدوات التحليل.

-   [ ] **إنشاء سكربت `scripts/registerMissingDocs.js`:**
    -   **المهمة:** يقرأ `module_manifest.json` ويقارنه بما هو مسجل في `DocsManager`.
    -   **المهمة:** يقوم بتوليد مسودات `DocsManager.registerModuleDocs(...)` للوحدات غير المسجلة.
    -   **الهدف:** تسريع عملية إضافة التوثيق المبدئي.

-   [ ] **تنفيذ التسجيل المبدئي:**
    -   **المهمة:** تشغيل السكربت وإضافة المسودات التي يولدها إلى ملفات الوحدات المعنية.

---

### ✳️ المرحلة التاسعة: تصحيح عدم تطابق التوثيق (Fixing Mismatches)

**الحالة: ✅ تم التنفيذ**

**الهدف:** مزامنة التوثيق الحالي مع الكود الفعلي.

-   **تم:** توثيق الدوال الناقصة في `System.ToolsDeveloper` (`addCommentsToCode`, `explainCode`).
-   **تم:** إزالة التوثيق القديم (Stale) في `System.Config` (`has`, `dump`).

---

### ✳️ المرحلة العاشرة: المراجعة الحية والمستمرة (Live & Continuous Auditing)

**الهدف:** جعل تدقيق التوثيق جزءًا لا يتجزأ من دورة حياة التطوير.

-   [ ] **إنشاء دالة `auditDocumentation()`:**
    -   **الملف:** `90_dev_runners.js`
    -   **الإجراء:** إضافة دالة يمكن تشغيلها يدويًا لاستدعاء `DocsAuditor.runAudit()` وطباعة التقرير.

-   [ ] **بناء تقرير حي للحالة (`live_docs_state.json`):**
    -   **المهمة:** تطوير `DocsAuditor` ليتمكن من تصدير تقرير JSON بحالة توثيق كل وحدة.
    -   **الهدف:** توفير نظرة سريعة ومبرمجة على صحة التوثيق يمكن استخدامها في لوحات المعلومات أو عمليات CI/CD المستقبلية.

---

## 🩺 خطة استدامة التوثيق (Documentation Sustainability Plan)

هذه الخطة مبنية على تقرير تدقيق التوثيق لضمان بقاء المشروع واضحًا وقابلاً للصيانة.

---

### ✳️ المرحلة الثامنة: بناء أساس التوثيق (Documentation Scaffolding)

**الهدف:** تسجيل جميع الوحدات غير الموثقة بشكل مبدئي لتفعيل أدوات التحليل.

-   [ ] **إنشاء سكربت `scripts/registerMissingDocs.js`:**
    -   **المهمة:** يقرأ `module_manifest.json` ويقارنه بما هو مسجل في `DocsManager`.
    -   **المهمة:** يقوم بتوليد مسودات `DocsManager.registerModuleDocs(...)` للوحدات غير المسجلة.
    -   **الهدف:** تسريع عملية إضافة التوثيق المبدئي.

-   [ ] **تنفيذ التسجيل المبدئي:**
    -   **المهمة:** تشغيل السكربت وإضافة المسودات التي يولدها إلى ملفات الوحدات المعنية.

---

### ✳️ المرحلة التاسعة: تصحيح عدم تطابق التوثيق (Fixing Mismatches)

**الحالة: ✅ تم التنفيذ**

**الهدف:** مزامنة التوثيق الحالي مع الكود الفعلي.

-   **تم:** توثيق الدوال الناقصة في `System.ToolsDeveloper` (`addCommentsToCode`, `explainCode`).
-   **تم:** إزالة التوثيق القديم (Stale) في `System.Config` (`has`, `dump`).

---

### ✳️ المرحلة العاشرة: المراجعة الحية والمستمرة (Live & Continuous Auditing)

**الهدف:** جعل تدقيق التوثيق جزءًا لا يتجزأ من دورة حياة التطوير.

-   [ ] **إنشاء دالة `auditDocumentation()`:**
    -   **الملف:** `90_dev_runners.js`
    -   **الإجراء:** إضافة دالة يمكن تشغيلها يدويًا لاستدعاء `DocsAuditor.runAudit()` وطباعة التقرير.

-   [ ] **بناء تقرير حي للحالة (`live_docs_state.json`):**
    -   **المهمة:** تطوير `DocsAuditor` ليتمكن من تصدير تقرير JSON بحالة توثيق كل وحدة.
    -   **الهدف:** توفير نظرة سريعة ومبرمجة على صحة التوثيق يمكن استخدامها في لوحات المعلومات أو عمليات CI/CD المستقبلية.

---

## ✅ الخلاصة

بتنفيذ هذه الخطة:

- النظام يتوقف عن الدوران في أخطاء التهيئة
- تُكسر حلقة الـ `TypeError` و`Placeholder` إلى الأبد
- يصبح المشروع مستقر، قابل للتوسعة، وذكي في استدعاء وحداته