# دستور فريق العمل (Team Project Rules)

## تعريف الملف

هذا المستند هو الدستور الصارم لفريق تطوير `g-assistant`. يضمّ جميع الإجراءات والالتزامات التي يجب اتباعها حرفيًا لتجنّب الأخطاء وضمان اتساق وسلامة الكود. إنه المرجع الأعلى الذي يربط جميع أدلة العمل الأخرى.

---

## مقدمة وفلسفة العمل (نصيحة استراتيجية)

إن وجود قواعد صارمة ليس هدفًا بحد ذاته، بل هو وسيلة لتحقيق هدف أسمى: **بناء منتج عالمي المستوى بكفاءة واستدامة**. كل قاعدة في هذا الدستور مصممة لمعالجة تحدٍ معين في دورة حياة تطوير البرمجيات، من منع الديون التقنية إلى تسريع عملية التطوير.

الوثائق التي أنشأناها سابقًا مثل `CODING_STANDARDS.md` و `DEPENDENCY_MANAGEMENT.md` هي أدوات تكتيكية، أما هذا المستند فهو **الخطة الاستراتيجية** التي توجه استخدام تلك الأدوات. الالتزام به هو التزام بنجاح المشروع على المدى الطويل.

---

## القواعد الصارمة

- **رسائل الالتزام (Commit Messages):** يجب الالتزام الكامل بتنسيق رسائل الالتزام كما هو موضح في `COMMIT_MESSAGE.md`:
  - تنسيق: `<نوع>(<النطاق>): <ملخص>`
  - الحد الأقصى للملخص 50 حرفاً، وصيغة الأمر (imperative mood).
  - لا يُرفع أي دمج بدون رسالة التزام مطابقة لهذه الصيغة.

- **سجل التغييرات (Changelog):** يجب تحديث سجل التغييرات في `CHANGELOG.md` قبل كل إصدار وإضافة كل ميزة أو تصحيح مع رقم الإصدار والتاريخ.

- **هيكل المشروع (Project Structure):** لا يجوز تعديل هيكل المجلدات الرئيسي خارج المواصفات المحددة في `PROJECT_STRUCTURE.md`.
  - كل وحدة (module) يجب أن توجد في المسار المعتمد ولا يُسمح بالاختصار أو إعادة التسمية.

- **فهرس التوثيق (Documentation Index):** قبل إضافة أي وثيقة جديدة أو تعديل قائمة التوثيق، يجب تحديث `DOCUMENTATION_INDEX.md` بالتفاصيل الكاملة للمستند.

- **المكتبات الخارجية (Library Usage):** لا يُسمح باستخدام أي مكتبة خارجية دون توثيقها مسبقاً في `LIBRARY_USAGE.md` والالتزام بنسخة ثابتة (pinned version) في ملف التكوين.

- **قائمة التحقق قبل التكامل (Integration Checklist):** قبل دمج أي فرع إلى `main`، يجب تشغيل ومراجعة قائمة التحقق في `INTEGRATION_CHECK.md` والتأكد من نجاح جميع الخطوات دون استثناء.

- **تقرير التحقق بعد التكامل (Integration Verification Report):** بعد كل دمج، يجب رفع تقرير تحقق التكامل في `INTEGRATION_VERIFICATION_REPORT.md` مع نتائج الاختبارات والوضع النهائي.

- **تحديث حالة التكامل (Integration Status Update):** يجب ملء نموذج تحديث حالة التكامل `INTEGRATION_STATUS_UPDATE.md` في بداية ونهاية كل دورة عمل، مع ذكر المشاكل والحلول المؤقتة.

- **النشر (Deployment):** لن يتم النشر إلى البيئة الحية إلا بعد اتباع التعليمات بدقة في `DEPLOYMENT_NOTES.md` وجميع الفحوصات المنصوص عليها بنجاح.

- **استرجاع الحالة (Recovery):** عند حدوث فشل أو عطل، يجب توثيق خطوات استرجاع الحالة في `RECOVERY_VERIFICATION.md` وتحديث النتائج قبل إعادة تشغيل النظام.

- **ترقية الإصدار (Upgrades):** لا يحق لأي مطور تحديث الإصدار الرئيسي أو الثانوي قبل مراجعة `UPGRADE_GUIDE.md` واتباع خطوات الترقية والاختبارات المرافقة.

- **سجل الإصدارات (Version History):** يجب إضافة مدخل في `VERSION_HISTORY.md` لكل إصدار جديد يتضمن التاريخ والملخص المختصر، مع ربطه بمدخل سجل التغييرات المناسب.

- **استكشاف الأخطاء (Troubleshooting):** عند مواجهة أي خطأ أو سلوك غير متوقع، يجب اتباع دليل `TROUBLESHOOTING.md` التحليلي وتوثيق الحل في نفس الملف قبل فتح تذكرة جديدة.

- **تتبع الاستخدام (Usage Tracking):** يجب تسجيل وتحليل كل استخدام وتفاعل للمساعد وفقاً لـ `USAGE_TRACKING.md` وتحديث البيانات دورياً لضمان المراقبة المستمرة.

- **البنية الهندسية (Architecture):** يمنع مطلقاً إضافة مكون أو تعديل في المعمارية خلافاً للخريطة الموضحة في `architecture.md`. أي تغيير مستقبلي يجب أن يمرّ بمراجعة معمارية رسمية.

- **إصلاحات الواجهة الأمامية (Vite Frontend):** عند إجراء تعديلات على الواجهة الأمامية المبنية بـ Vite يجب تطبيق خطوات الإصلاح المحددة في `VITE_FIX_GUIDE.md` قبل أي اختبارات وظائف.

---

## ملحق: دليل البدء السريع واستكشاف الأخطاء

هذا الملخص هو دليلك العملي لتجنب الأخطاء الشائعة وتسريع وتيرة عملك.

### أولاً: إعداد المشروع والمصادقة (الأخطاء الشائعة)

- **دقة مطلقة** في خطوات Google Cloud Console قبل تشغيل الكود.
- إنشاء مشروع جديد وتفعيل **Google Assistant API**.
- إعداد شاشة موافقة OAuth كـ **External** مع إضافة حسابك في **Test Users**.
- إنشاء عميل OAuth 2.0 من نوع **“Desktop app” فقط**.
- وضع `client_secret.json` في المجلد الرئيسي وبالتسمية الصحيحة.

### ثانياً: نصائح برمجية ومنهجية التطوير

- استخدم بيئة افتراضية مع `python -m venv venv` قبل أي تثبيت.
- ثبّت الاعتماديات عبر `pip install -r requirements.txt` فقط.
- افهم آلية **تخزين التوكن (token caching)**: وحل خطأ `invalid_grant` بحذف `token.pickle`.
- اكتب كودًا مرنًا للتعامل مع فشل الميكروفون وعرض رسائل واضحة.
- **ممارسات المساهمة:**
  - لا تعمل على `main` مباشرة، بل أنشئ فرعًا جديدًا لكل مهمة.
  - اكتب رسائل `commit` واضحة وفق `COMMIT_MESSAGE.md`.
  - اتبع تنسيق الكود المحدد في `CODING_STANDARDS.md`.
  - اختبر تغييراتك جيدًا قبل رفع طلب السحب (Pull Request).

### ثالثاً: استكشاف الأخطاء وإصلاحها (Troubleshooting)

- **`invalid_grant`**: احذف `token.pickle` ثم أعد المصادقة.
- **`Error 403: access_denied`**: تأكد من إضافة بريدك الإلكتروني في **Test Users** على شاشة موافقة OAuth.
- **مشاكل الصوت/ميكروفون**: تحقق من إعدادات النظام وتأكد من منح الإذن للبرنامج للوصول إلى الميكروفون.

---

## الالتزام النهائي

- لا يتم تجاهل أي قاعدة من القواعد أعلاه تحت أي ظرف.
- يجب تضمين هذا الملف ضمن خط سير التكامل المستمر (CI/CD) كفحص إلزامي قبل الدمج والنشر.
- يحق لمدير المشروع تعليق حق رفع الأكواد لمن يخالف هذه القواعد حتى تصحيح الوضع.